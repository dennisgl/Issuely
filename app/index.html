<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>Issuely</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <link rel="stylesheet" href="bower_components/c3/c3.css" />
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <h1 id="headLine"></h1>
    <div id="chart"></div>


    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/d3/d3.js"></script>
    <script src="bower_components/c3/c3.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <!-- endbower -->
    <!-- endbuild -->


    <script type="text/javascript">
    $(function(){
        var r = (/.*?owner=(.+)&repo=(.+)/g).exec(document.location.href    );
        ownerName = r[1];
        repoName = r[2]

        $('#headLine').text(repoName);


        var words = function(sentences){
         
          var sWords = sentences.join(' ').toLowerCase().trim().replace(/[,;.\#\%\@\?\\\!\[\]\`\'\(\)\<\>\{\}\:\+\-\*\/\=\"\$]/g,' ').split(/[\s\/]+/g).sort();
          var iWordsCount = sWords.length; // count w/ duplicates
         
          // array of words to ignore
          var ignore = ['and','the','to','a','of','for','as','i','with','it','is','on','that','this','can','in','be','has','if'];
          ignore = (function(){
            var o = {}; // object prop checking > in array checking
            for ( var i=0; i<60000; i++) {
                o[i] = true;
            }
            var iCount = ignore.length;
            for (var i=0;i<iCount;i++){
              o[ignore[i]] = true;
            }
            return o;
          }());
         
          var counts = {}; // object for math
          for (var i=0; i<iWordsCount; i++) {
            var sWord = sWords[i];
            if (!ignore[sWord]) {
              counts[sWord] = counts[sWord] || 0;
              counts[sWord]++;
            }
          }
         
          var arr = []; // an array of objects to return
          for (sWord in counts) {
            arr.push({
              text: sWord,
              frequency: counts[sWord]
            });
          }
         
          // sort array by descending frequency | http://stackoverflow.com/a/8837505
          return arr.sort(function(a,b){
            return (a.frequency > b.frequency) ? -1 : ((a.frequency < b.frequency) ? 1 : 0);
          });
        };

        var chart = c3.generate({
            bindto: '#chart',
            data: {
                x : 'x',
                columns: [
                    ['x', 'w1', 'w2'],
                    ['frequency', 9, 4],
                ],
                type: 'bar'
            },
            axis: {
                x: {
                    type: 'category',
                    tick: {
                        rotate: 75,
                        multiline: false
                    },
                    height: 130
                },
                rotate: true
            }
        });

        var blackList = [
        ' ',
        '&nbsp',
        'at',
        'the',
        'a',
        'b',
        'c',
        'd',
        'e',
        'f',
        'g',
        'h',
        'i',
        'j',
        'k',
        'l',
        'm',
        'n',
        'o',
        'p',
        'q',
        'r',
        's',
        't',
        'u',
        'v',
        'w',
        'x',
        'y',
        'z',
        'an',
        'com',
        'jquery',
        'jsfiddle',
        'github',
        'http',
        'https',
        'wiki',
        '0',
        '1',
        '2',
        '3',
        '4',
        '5',
        '6',
        '7',
        '8',
        '9',
        '10',
        'tt',
        'this',
        'that',
        'bug',
        'bugs',
        'report',
        'reported',
        'will',
        'would',
        'are',
        'were',
        'not',
        'should',
        'is',
        'was',
        'only',
        'which',
        'or',
        'yes',
        'no',
        'problem',
        'problems',
        'if',
        'one',
        'then',
        'other',
        'all',
        'when',
        'have',
        'but',
        'has',
        'had',
        'also',
        'do',
        'did',
        'need',
        'change',
        'jsbin',
        'line',
        'because',
        'js',
        'by',
        'ticket',
        'use',
        '&lt',
        '&gt',
        'any',
        'get',
        'so',
        'there',
        'src',
        'my',
        'mine',
        'you',
        'your',
        'yours',
        'value',
        'return',
        'function',
        'var',
        'run',
        'up',
        'down',
        'from',
        'using',
        'see',
        'version',
        'like',
        'it',
        'true',
        'net',
        'we',
        'they',
        'them',
        'does',
        'way',
        'closed',
        'work',
        'fiddle',
        'png',
        'same',
        'how',
        'may',
        'here',
        'new',
        'tag',
        'changes',
        'javascript',
        'before',
        'after',
        'inside',
        'similar',
        'first',
        'second',
        'third',
        'into',
        'just',
        'html',
        'issues',
        'pull',
        'now',
        'c3',
        'd3',
        'hi',
        'set',
        'great',
        'something',
        'in',
        'out',
        'application',
        'thanks',
        'more',
        'right',
        'left',
        'wrong',
        'correct',
        'want',
        'via',
        'back',
        'forward',
        'error',
        'errors',
        'kib',
        'some',
        'many',
        'much',
        'very',
        '00',
        'warn',
        'warning',
        'call',
        'null',
        'err',
        'module',
        'file',
        'code',
        'old',
        'obj',
        'org',
        'end',
        'log',
        'test',
        'api',
        'require',
        'target',
        'process',
        'v0',
        'console',
        'case',
        'ng',
        'scope',
        'directive',
        'issue',
        'app',
        'apps',
        'url',
        'co',
        'com',
        'what',
        'foo',
        'bar',
        'id',
        'plnkr',
        'angularjs',
        'data',
        'top',
        'type',
        '001',
        'am',
        'cpp',
        'output',
        'input',
        'select',
        'example',
        'object',
        'class',
        'works',
        'form',
        'could',
        'scala',
        'ruby',
        'add',
        'copy',
        'enrich',
        'than',
        'then',
        'www',
        'each',
        'for',
        'while',
        'jar',
        'java',
        '|',
        'lib',
        'repo',
        'repository',
        'lang',
        'bin',
        '_id',
        'info',
        'user',
        'users',
        'invoke',
        'sun',
        'name',
        'main',
        '_',
        'think',
        'value',
        'values',
        'where',
        'bob',
        'hi',
        'hello',
        'return',
        'returns',
        'these',
        'those',
        'allow',
        'people',
        'key',
        'result',
        'yet',
        'versions',
        'apple',
        'os',
        'py',
        'self',
        'python',
        'java',
        'site',
        'python2',
        'import',
        'text',
        'dist',
        'config',
        'print',
        'last',
        'def',
        'make',
        'files',
        'string',
        'tests',
        'most',
        'less',
        'tab',
        'script',
        'package',
        'packages',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',];
        blackList.push(ownerName);
        blackList.push(repoName);

        var render = function(resultData) {
            var freqResult = words(_.pluck(resultData,'body'));
            freqResult = _.filter(freqResult, function(item){
                return item.frequency>=5 && !_.contains(blackList, item.text);
            });


            var textList = _.pluck(freqResult, 'text').slice(0,40);
            var freqList = _.pluck(freqResult, 'frequency').slice(0,40);

            chart.load({
                columns: [
                    ['x'].concat(textList),
                    ['frequency'].concat(freqList),
                ]
            });
        }

        var resultData=[];
        var fetchDone = false;
        var pageNum = 1;
        var fetch = function() {
            $.getJSON('https://api.github.com/repos/'+ownerName+'/'+repoName+'/issues',
            {
                client_id:'5e69207e53e937646e91',
                client_secret: '6dba8bee25c46db058976ce2e83b83c8a375ea28',
                page:pageNum++,
                per_page:100
            },function(data){
                if ( data.length === 0 ) {
                    fetchDone = true;
                    return ;
                }
                resultData = resultData.concat(data);
                render(resultData);
                console.log('yeap');
            }).fail(function(){fetchDone=true;});

            if (!fetchDone) {
                setTimeout(fetch,1000);
            }
        };

        fetch();

        chart.load({
            columns: [
                ['x', 'w1', 'w2'],
                ['frequency', 10, 20],
            ]
        });


    });

    </script>



    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-XXXXX-X');ga('send','pageview');
    </script>



        <!-- build:js({app,.tmp}) scripts/main.js -->
        <script src="scripts/main.js"></script>
        <!-- endbuild -->
</body>
</html>

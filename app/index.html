<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>Issuely</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <link rel="stylesheet" href="bower_components/nvd3/src/nv.d3.css" />
    <link rel="stylesheet" href="bower_components/semantic-ui/dist/semantic.css" />
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div id="container">
        <h1 id="title" class="ui header">Issuely - Github issue analysis</h1>
        <div id="chart"><svg></svg></div>
        <div>
            <div class="ui input">
              <a class="ui huge orange label">Owner</a><input id="ownerInput" type="text" placeholder="owner">
            </div>
            <div class="ui input">
              <a class="ui huge orange label">Repo Name</a><input id="repoInput" type="text" placeholder="Repo name=">
            </div>
            <div class="ui huge green button" id="fetchBtn">fetch</div>
        </div>
    </div>

    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <script src="bower_components/d3/d3.js"></script>
    <script src="bower_components/nvd3/nv.d3.js"></script>
    <script src="bower_components/semantic-ui/dist/semantic.js"></script>
    <!-- endbower -->
    <!-- endbuild -->


    <script type="text/javascript">
    $(function(){
        var ownerName, repoName;

        $('#headLine').text(repoName);
        var words = function(sentences){
         
          var sWords = sentences.join(' ').toLowerCase().trim().replace(/[,;.\#\%\@\?\\\!\[\]\`\'\(\)\<\>\{\}\:\+\-\*\/\=\"\$]/g,' ').split(/[\s\/]+/g).sort();
          var iWordsCount = sWords.length; // count w/ duplicates
         
          // array of words to ignore
          var ignore = ['and','the','to','a','of','for','as','i','with','it','is','on','that','this','can','in','be','has','if'];
          ignore = (function(){
            var o = {}; // object prop checking > in array checking
            for ( var i=0; i<60000; i++) {
                o[i] = true;
            }
            var iCount = ignore.length;
            for (var i=0;i<iCount;i++){
              o[ignore[i]] = true;
            }
            return o;
          }());
         
          var counts = {}; // object for math
          for (var i=0; i<iWordsCount; i++) {
            var sWord = sWords[i];
            if (!ignore[sWord]) {
              counts[sWord] = counts[sWord] || 0;
              counts[sWord]++;
            }
          }
         
          var arr = []; // an array of objects to return
          for (sWord in counts) {
            arr.push({
              label: sWord,
              value: counts[sWord]
            });
          }
         
          // sort array by descending frequency | http://stackoverflow.com/a/8837505
          return arr.sort(function(a,b){
            return (a.value > b.value) ? -1 : ((a.value < b.value) ? 1 : 0);
          });
        };
        var _data = {key:repoName, values: []};
        var chart;
        nv.addGraph(function() {
          chart = nv.models.discreteBarChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .staggerLabels(true)
            .tooltips(false)
            .showValues(true)

          chart.yAxis
                .tickFormat(d3.format('.0f'));

          d3.select('#chart svg')
            .datum(_data)
            .transition().duration(500)
            .call(chart)
            ;

          nv.utils.windowResize(chart.update);

          return chart;
        });

        var blackList = [
        ' ',
        '&nbsp',
        'at',
        'the',
        'a',
        'b',
        'c',
        'd',
        'e',
        'f',
        'g',
        'h',
        'i',
        'j',
        'k',
        'l',
        'm',
        'n',
        'o',
        'p',
        'q',
        'r',
        's',
        't',
        'u',
        'v',
        'w',
        'x',
        'y',
        'z',
        'an',
        'com',
        'jquery',
        'jsfiddle',
        'github',
        'http',
        'https',
        'wiki',
        '0',
        '1',
        '2',
        '3',
        '4',
        '5',
        '6',
        '7',
        '8',
        '9',
        '10',
        'tt',
        'this',
        'that',
        'bug',
        'bugs',
        'report',
        'reported',
        'will',
        'would',
        'are',
        'were',
        'not',
        'should',
        'is',
        'was',
        'only',
        'which',
        'or',
        'yes',
        'no',
        'problem',
        'problems',
        'if',
        'one',
        'then',
        'other',
        'all',
        'when',
        'have',
        'but',
        'has',
        'had',
        'also',
        'do',
        'did',
        'need',
        'change',
        'jsbin',
        'line',
        'because',
        'js',
        'by',
        'ticket',
        'use',
        '&lt',
        '&gt',
        'any',
        'get',
        'so',
        'there',
        'src',
        'my',
        'mine',
        'you',
        'your',
        'yours',
        'value',
        'return',
        'function',
        'var',
        'run',
        'up',
        'down',
        'from',
        'using',
        'see',
        'version',
        'like',
        'it',
        'true',
        'net',
        'we',
        'they',
        'them',
        'does',
        'way',
        'closed',
        'work',
        'fiddle',
        'png',
        'same',
        'how',
        'may',
        'here',
        'new',
        'tag',
        'changes',
        'javascript',
        'before',
        'after',
        'inside',
        'similar',
        'first',
        'second',
        'third',
        'into',
        'just',
        'html',
        'issues',
        'pull',
        'now',
        'c3',
        'd3',
        'hi',
        'set',
        'great',
        'something',
        'in',
        'out',
        'application',
        'thanks',
        'more',
        'right',
        'left',
        'wrong',
        'correct',
        'want',
        'via',
        'back',
        'forward',
        'error',
        'errors',
        'kib',
        'some',
        'many',
        'much',
        'very',
        '00',
        'warn',
        'warning',
        'call',
        'null',
        'err',
        'module',
        'file',
        'code',
        'old',
        'obj',
        'org',
        'end',
        'log',
        'test',
        'api',
        'require',
        'target',
        'process',
        'v0',
        'console',
        'case',
        'ng',
        'scope',
        'directive',
        'issue',
        'app',
        'apps',
        'url',
        'co',
        'com',
        'what',
        'foo',
        'bar',
        'id',
        'plnkr',
        'angularjs',
        'data',
        'top',
        'type',
        '001',
        'am',
        'cpp',
        'output',
        'input',
        'select',
        'example',
        'object',
        'class',
        'works',
        'form',
        'could',
        'scala',
        'ruby',
        'add',
        'copy',
        'enrich',
        'than',
        'then',
        'www',
        'each',
        'for',
        'while',
        'jar',
        'java',
        '|',
        'lib',
        'repo',
        'repository',
        'lang',
        'bin',
        '_id',
        'info',
        'user',
        'users',
        'invoke',
        'sun',
        'name',
        'main',
        '_',
        'think',
        'value',
        'values',
        'where',
        'bob',
        'hi',
        'hello',
        'return',
        'returns',
        'these',
        'those',
        'allow',
        'people',
        'key',
        'result',
        'yet',
        'versions',
        'apple',
        'os',
        'py',
        'self',
        'python',
        'java',
        'site',
        'python2',
        'import',
        'text',
        'dist',
        'config',
        'print',
        'last',
        'def',
        'make',
        'files',
        'string',
        'tests',
        'most',
        'less',
        'tab',
        'script',
        'package',
        'packages',
        'ui',
        'semantic',
        'div',
        'element',
        'css',
        'page',
        'default',
        'example',
        'create',
        'used',
        'jpg',
        'nice',
        'githubusercontent',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',];
        blackList.push(ownerName);
        blackList.push(repoName);
        var render = function(resultData) {
            var freqResult = words(_.pluck(resultData,'body'));
            freqResult = _.filter(freqResult, function(item){
                return item.value>=5 && !_.contains(blackList, item.label);
            });freqResult = freqResult.slice(0,20);
            // Array.prototype.splice.apply(_data.values,freqResult);
            _data.values = freqResult;

            d3.select('#chart svg')
            .datum([_data])
            .transition().duration(500)
            .call(chart)
            ;


            // console.log('ch',chart.update);
            chart.update();

        }
        var resultData=[];
        var fetchDone = false;
        var pageNum = 1;
        var fetch = function() {
            $.getJSON('https://api.github.com/repos/'+ownerName+'/'+repoName+'/issues',
            {
                client_id:'5e69207e53e937646e91',
                client_secret: '6dba8bee25c46db058976ce2e83b83c8a375ea28',
                page:pageNum++,
                per_page:100
            },function(data){
                if ( data.length === 0 ) {
                    fetchDone = true;
                    return ;
                }
                resultData = resultData.concat(data);
                render(resultData);
                console.log('yeap');
            }).fail(function(){fetchDone=true;});
            if (!fetchDone) {
                setTimeout(fetch,1000);
            }
        };
        
        $('#fetchBtn').click(function(){
            ownerName = $('#ownerInput').val();
            $('#ownerInput').val('');
            repoName = $('#repoInput').val();
            $('#repoInput').val('');
            $('#title').text(repoName);
            fetch();
        });

        window._data = _data;
    });

    </script>



        <!-- build:js({app,.tmp}) scripts/main.js -->
        <script src="scripts/main.js"></script>
        <!-- endbuild -->
</body>
</html>
